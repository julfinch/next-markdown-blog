# NEXT-MARKDOWN-BLOG

## SETUP
1. Install Next.js on current folder `npx create-next-app .`
1. Install dependencies with `npm i marked gray-matter`
1. Run the project with `npm run dev`
1. Clean up the folder by deleting the **api folder** since we are not using any API routes. Edit `index.js` and start with clean slate.
    ```shell
        import Head from 'next/head'
        import { Inter } from 'next/font/google'
        import styles from '@/styles/Home.module.css'

        const inter = Inter({ subsets: ['latin'] })

        export default function Home() {
        return (
            <>
            <Head>
                <title>Finch Dev Blog</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <h2>Hello</h2>
            </>
        )
        }
    ```
1. Delete **Home.module.css** inside the **styles folder** and paste the code below inside our **global.css**.
    ```shell
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400&display=swap');

        * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        }

        body {
        font-family: 'Poppins', sans-serif;
        }

        p {
        margin: 15px 0;
        line-height: 1.8;
        }

        a {
        text-decoration: none;
        color: #333;
        }

        img {
        width: 100%;
        border-radius: 10px;
        }

        header {
        background: steelblue;
        color: #fff;
        padding: 5px;
        margin-bottom: 40px;
        }

        header a {
        color: #fff;
        }

        .container {
        max-width: 768px;
        margin: auto;
        overflow: auto;
        padding: 0 10px;
        }

        .btn {
        display: inline-block;
        background: steelblue;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        text-decoration: none;
        font-size: 15px;
        font-family: inherit;
        }

        .btn:focus {
        outline: none;
        }

        .btn:hover {
        transform: scale(0.98);
        }

        .btn-back {
        background: #f4f4f4;
        color: #000;
        margin-bottom: 20px;
        }

        .posts {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 30px;
        margin-top: 30px;
        }

        .card {
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }

        .card-page {
        padding: 15px 30px;
        }

        .post-title {
        margin: 10px 0;
        }

        .post-date {
        background: #f4f4f4;
        margin-bottom: 20px;
        padding: 3px 10px;
        }

        .post-body ul,
        ol {
        font-size: 110%;
        line-height: 2.3;
        font-weight: bold;
        margin: 10px 0;
        }

        .post-body pre {
        background: #f4f4f4;
        padding: 20px;
        margin: 20px 0;
        line-height: 2.3;
        }

        @media (max-width: 500px) {
        .posts {
            grid-template-columns: 1fr;
        }
        }
    ```

## SET-UP HEADER
1. Inside the root folder, create a new folder called **components**. Inside it, create a new file called **Header.js**. Write `_rfc` to get a boiler plate for component.
    ```shell
        import React from 'react'
        import Link from 'next/link'

        export default function Header() {
            return (
                <header>
                    <div className="container">
                        <Link href='/'>
                            <h2>Finch Dev Blog</h2>
                        </Link>
                    </div>
                </header>
            )
        }
    ```

1. Update **_app.js** folder and import the `<Header/>`. Also create a node called `main` so that the body of all our pages will be wrapped by a container.
    ```shell
        import '@/styles/globals.css'
        import Header from '../../components/Header'

        export default function App({ Component, pageProps }) {
        return (
        <>
            <Header/>
            <main className="container">
            <Component {...pageProps} />
            </main>
        </>
        )
        }
    ```

## POSTS
1. Under the `public folder`, create a new folder named `images` and another folder inside it named `posts` where we put the images that we will use for the blog posts.
1. Under the root folder, create a new folder named `posts`, this is where we will put our `.MD` files for the blog posts. Create a file inside it named `test.md` to initiate the connection.
    ```shell
        ---
        title: 'Test Post'
        date: 'May 1, 2023'
        excerpt: 'This is the excerpt'
        cover_image: '/images/posts/img1.jpg'
        ---
        ## Heading Two

        * Item 1
        * Item 2
    ``` 
1. Right click inside the editor and click `Markdown Preview Enhanced: Open Preview to the Right` from our extension to show a preview of our MD file.
1. Open `index.js` and initiate `getStaticProps` below it. In the browser's console tab, we should be able to see `The Posts` from the terminal.
    ```shell
        import Head from 'next/head'

        export default function Home({posts}) {
        console.log(posts)
        return (
            <>
            <Head>
                <title>Finch Dev Blog</title>
            </Head>
            <h2>Hello</h2>
            </>
        )
        }

        export async function getStaticProps() {
        return {
            props: {
            posts: 'The Posts'
            }
        }
        }
    ```
1. We will use `fs` to be able to read the files inside the `posts` folder. Also import `path` along with it.
    ```shell
        import Head from 'next/head'
        import fs from 'fs'
        import path from 'path'

        export default function Home({posts}) {
        console.log(posts)
        return (
            <>
            <Head>
                <title>Finch Dev Blog</title>
            </Head>
            <h2>Hello</h2>
            </>
        )
        }

        export async function getStaticProps() {
        const files = fs.readdirSync(path.join('posts'))
        console.log(files)
        return {
            props: {
            posts: 'The Posts'
            }
        }
        }
    ```
1. We should be able to see `[ 'test.md' ]` from our VScode terminal.
1. To get the slug and frontmatter from our posts, we need to map through our files. We should see `[ { slug: 'test' } ]` from our VScode terminal.
    ```shell
        export async function getStaticProps() {
        #Get files from the posts directory
        const files = fs.readdirSync(path.join('posts'))
        
        # Get slug and frontmatter from posts
        const posts = files.map((filename) => {
            # Create slug
            # We will replace the .md tag with nothing and return the slug
            # We should get an array with the objects with slug and filename
            const slug = filename.replace(".md", "")

            return {
            slug,
            }
        })

        console.log(posts)
        return {
            props: {
            posts: 'The Posts'
            }
        }
        }
    ```
1. To get the `frontmatter`, we will need again the `fs` to read the file and we will have it joined with its filename. We also need `utf-8` for this. 
    ```shell
        export async function getStaticProps() {
        const files = fs.readdirSync(path.join('posts'))

            const slug = filename.replace(".md", "")

            # Get frontmatter
            const markdownWithMeta = fs.readFileSync(
            path.join('posts', filename), 
            'utf-8'
            )

            console.log(markdownWithMeta)
            return {
            slug,
            }
        })

        console.log(posts)
        return {
            props: {
            posts: 'The Posts'
            }
        }
        }
    ```
1. From the Vscode terminal, we should see:
    ```shell
        ---
        title: 'Test Post'
        date: 'May 1, 2023'
        excerpt: 'This is the excerpt'
        cover_image: '/images/posts/img1.jpg'
        ---
        ## Heading Two

        * Item 1
        * Item 2
        [ { slug: 'test' } ]
        The Posts
    ```
1. To parse markdownMeta, we use gray-matter and wrap it. Destructure to extract the data and rename it as frontmatter. In addition to the slug, we will also return frontmatter.
    ```shell
        import matter from 'gray-matter'

        export async function getStaticProps() {
        const files = fs.readdirSync(path.join('posts'))
        
        const posts = files.map((filename) => {
            
            const slug = filename.replace(".md", "")
            
            const markdownWithMeta = fs.readFileSync(
            path.join('posts', filename), 
            'utf-8'
            )

            # To parse markdownMeta, we use gray-matter and wrap it
            # Destructure to extract the data and rename it as frontmatter
            # In addition to the slug, we will also return frontmatter
            const { data: frontmatter } = matter(markdownWithMeta)
            return {
            slug,
            frontmatter
            }
        })

        console.log(posts)
        return {
            props: {
            posts: 'The Posts'
            }
        }
        }
    ```
1. From the Vscode terminal, we should get an array with one object with the slug and the frontmatter with the title, date, excerpt and cover_image.
    ```shell
        [
        {
            slug: 'test',
            frontmatter: {
                title: 'Test Post',
                date: 'May 1, 2023',
                excerpt: 'This is the excerpt',
                cover_image: '/images/posts/img1.jpg'
            }
        }
        ]
        The Posts
    ```
1. We will now make our `md` file appear in our front page by mapping all the posts inside our `index.js` and show the `posts title`. We should be able to see now inside our `localhost:3000` the `Test Post`.
Add the sample `md` files into the `posts` folder and we should now see the titles in the page. We can also see inside our browser's console and array oof 7 objects, `(7)[{...}, {...}, {...}, {...},{...}, {...}, {...}]`.
    ```shell
        import Head from 'next/head'
        import fs from 'fs'
        import path from 'path'
        import matter from 'gray-matter'

        export default function Home({posts}) {
        console.log(posts)
        return (
            <>
            <Head>
                <title>Finch Dev Blog</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <div className="posts">
                {posts.map((post, index) => (
                <h3>{post.frontmatter.title}</h3>
                ))}
            </div>
            </>
        )
        }

        export async function getStaticProps() {
        const files = fs.readdirSync(path.join('posts'))
        
        const posts = files.map((filename) => {
            const slug = filename.replace(".md", "")

            const markdownWithMeta = fs.readFileSync(
            path.join('posts', filename), 
            'utf-8'
            )

            const { data: frontmatter } = matter(markdownWithMeta)
            return {
            slug,
            frontmatter
            }
        })

        return {
            props: {
            posts
            }
        }
        }
    ```

## POST.JS
1. We will now start to create a separate component for each posts by creating a `Post.js` file inside `components folder`.
    ```shell
        import React from 'react'
        import Link from 'next/link'

        export default function Post({ post }) {
        return (
            <div className="card">
                <img src={post.frontmatter.cover_image} alt="" />

                <div className="post-date">Posted on {post.frontmatter.date}</div>

                <h3>{post.frontmatter.title}</h3>

                <p>{post.frontmatter.excerpt}</p>

                <Link href={`/blog/${post.slug}`}>
                    <button className="btn">Read More</button>
                </Link>
            </div>
        )
        }
    ```
1. Import `<Post>` component into `index.js` inside the map function.
    ```shell
        <div className="posts">
        {posts.map((post, index) => (
            <Post post={post} />
        ))}
        </div>
    ```

## [slug].js
1. We want our link for each of the blog posts to have `/blog` before the `/slug name`. NextJS made routing easier by automatically incorporating it based on the folder and file structure we made inside `pages folder`. To achieve the link structure that we want, under `pages`, we will create a folder named `blog` so it will automatically become `/blog` in the link. For the static paths for each slug name, we will create a file named `[slug].js`.
    ### getStaticPaths()
    1. We will again use `fs` in this component to access the files in our directory of the folder named `posts` and get each one of them and put inside . Then we will get the filename, remove the `.md` tag at its tail end and assign to a variable as `slug`. We then combine it with the frontmatter. Make sure to put a `fallback: false` so that when we input a wrong slug, we will be redirected to the 404 page. We should be getting in our terminal an array of objects with params as seen below:
        ```shell
            [
            {
                slug: 'django-crash-course',
                frontmatter: {
                title: 'Django Crash Course',
                date: 'March 5, 2021',
                excerpt: 'Django is a very powerful, high level Python framework for building web applications',
                cover_image: '/images/posts/img3.jpg'
                }
            },
            {
                slug: 'javascript-performance-tips',
                frontmatter: {
                title: 'JavaScript Performance Tips',
                date: 'March 4, 2021',
                excerpt: 'We will look at 10 simple tips and tricks to increase the speed of your code when writing JS',
                cover_image: '/images/posts/img1.jpg'
                }
            },
            {
                slug: 'new-in-php-8',
                frontmatter: {
                title: "What's New In PHP 8?",
                date: 'March 7, 2021',
                excerpt: 'In this article we will look at some of the new features offered in version 8 of PHP',
                cover_image: '/images/posts/img4.jpg'
                }
            },
            {
                slug: 'python-book-review',
                frontmatter: {
                title: 'Python Book Review',
                date: 'March 7, 2021',
                excerpt: 'In this review, we will be looking at the new Python book from Oriley',
                cover_image: '/images/posts/img6.jpg'
                }
            },
            {
                slug: 'react-crash-course',
                frontmatter: {
                title: 'React Crash Course',
                date: 'March 8, 2021',
                excerpt: 'Crash course to learn the React JavaScript library. We will look at components, hooks and more',
                cover_image: '/images/posts/img5.jpg'
                }
            },
            {
                slug: 'tailwind-vs-bootstrap',
                frontmatter: {
                title: 'Tailwind vs. Bootstrap',
                date: 'March 5, 2021',
                excerpt: 'Both Tailwind and Bootstrap are very popular CSS frameworks. In this article, we will compare them',
                cover_image: '/images/posts/img2.jpg'
                }
            },
            {
                slug: 'writing-great-unit-tests',
                frontmatter: {
                title: 'Writing Great Unit Tests',
                date: 'March 12, 2021',
                excerpt: 'We will look at 10 simple tips and tricks on writing unit tests in JavaScript',
                cover_image: '/images/posts/img7.jpg'
                }
            }
            ]
        ```
    ### getStaticProps()
    1. Now that we can get the params using the `getStaticPaths()` method we created above, we can now access it to be used for `getStaticProps()` by passing it as props.
    ```shell
        export async function getStaticProps({ params: { slug } }) {
            const markdownWithMeta = fs.readFileSync(path.join('posts', slug + '.md'), 'utf-8')

            const {data: frontmatter, content} = matter(markdownWithMeta)

            return {
                props: {
                    frontmatter,
                    slug,
                    content
                }
            }
        }
    ```
    1. Pass on the props to our `PostPage`
    ```shell
        export default function PostPage({ frontmatter: { title, date, cover_image}, slug, content,}) {
            return (
            <>
                <Link href='/'>
                    <button className="btn btn-back">Go Back</button>
                </Link>
                <div className="card card-page">
                    <h1 className="post-title">{title}</h1>
                    <div className="post-date">Posted on {date}</div>
                    <img src={cover_image} alt="" />
                    <div className="post-body">
                        {/* <div dangerouslySetInnerHTML={{ __html: marked(content) }}></div> */}
                        <ReactMarkdown>{content}</ReactMarkdown>
                    </div>
                </div>
            </>
            )
        }
    ```

## ARRANGE THE POSTS FROM LATEST TO OLDEST
1. Under the root folder, create a folder named `utils` and inside it, make a file named `index.js` and paste the code below:
    ```shell
        export const sortByDate = (a, b) => {
            return new Date(b.frontmatter.date) - new Date(a.frontmatter.date)
        }
    ```
1. Open `index.js` of our main page and add the sort method to the posts. Also, import the `sortByDate` utility inside it.
    ```shell
        import { sortByDate } from '../../utils'

        export async function getStaticProps() {
        const files = fs.readdirSync(path.join('posts'))
        
        const posts = files.map((filename) => {
            const slug = filename.replace(".md", "")

            const markdownWithMeta = fs.readFileSync(
            path.join('posts', filename), 
            'utf-8'
            )

            const { data: frontmatter } = matter(markdownWithMeta)
            return {
            slug,
            frontmatter
            }
        })

        return {
            props: {
            posts: posts.sort(sortByDate)
            }
        }
        }
    ```

## ISSUES AND REITERATIONS
1. Issue with `marked` giving errors. Uninstall it if it's using the latest version and install an older version instead. Other solution is to install the latest but using `import {marked} from marked`.
    ```shell
        npm i marked@2.1.2
    ```
1. Instead of using `dangerouslySetInnerHTML` to display the post's content, just install `react-markdown` and type the code below:
    ```shell
        <ReactMarkdown>{content}</ReactMarkdown>
    ```
1. Also, `path.join()` is unnecessary in `const files = fs.readdirSync(path.join('posts))`. Just write the code below instead to make is easy to understand:
    ```shell
        const files = fs.readdirSync('posts')
    ```
